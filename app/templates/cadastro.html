{% load static %}
<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Cadastro - Minha Loja</title>
  <link rel="stylesheet" href="{% static 'css/style.css' %}">
  <style>
    body {
      background: #f8fafc;
      margin: 0;
      padding: 40px;
      color: #111;
    }

    .registration-container {
      max-width: 500px;
      margin: 0 auto;
    }

    .registration-header {
      text-align: center;
      margin-bottom: 30px;
    }

    .registration-header h2 {
      margin: 0 0 10px 0;
      font-size: 2rem;
    }

    .registration-header p {
      margin: 0;
      color: #6b7280;
      font-size: 0.95rem;
    }

    .back-link {
      text-align: center;
      margin-bottom: 20px;
    }

    .back-link a {
      color: #16a34a;
      text-decoration: none;
      font-weight: 600;
    }

    .back-link a:hover {
      text-decoration: underline;
    }

    .messages {
      margin-bottom: 20px;
    }

    .message {
      padding: 12px 15px;
      margin-bottom: 8px;
      border-radius: 8px;
      border-left: 4px solid;
    }

    .message.error {
      background-color: #fee2e2;
      border-color: #ef4444;
      color: #991b1b;
    }

    .message.success {
      background-color: #dcfce7;
      border-color: #16a34a;
      color: #166534;
    }

    .tabs {
      display: flex;
      background: #e2e8f0;
      border-radius: 10px;
      overflow: hidden;
      margin-bottom: 30px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }

    .tab-btn {
      flex: 1;
      padding: 12px;
      background: transparent;
      border: none;
      cursor: pointer;
      font-weight: 600;
      transition: all 0.2s;
      color: #6b7280;
    }

    .tab-btn.active {
      background: #16a34a;
      color: white;
    }

    .tab-btn:hover {
      background: rgba(22, 163, 74, 0.1);
    }

    .form-box {
      background: white;
      padding: 30px;
      border-radius: 12px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      display: none;
      max-height: 80vh;
      overflow-y: auto;
    }

    .form-box.active {
      display: block;
      animation: slideUp 0.3s ease-out;
    }

    @keyframes slideUp {
      from {
        opacity: 0;
        transform: translateY(10px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .form-section {
      margin-bottom: 20px;
    }

    .form-section-title {
      font-weight: 700;
      color: #1f2937;
      margin-bottom: 15px;
      padding-bottom: 10px;
      border-bottom: 2px solid #e5e7eb;
      font-size: 0.95rem;
    }

    .form-section:first-child .form-section-title {
      margin-top: 0;
    }

    .form-group {
      margin-bottom: 15px;
    }

    label {
      display: block;
      margin-bottom: 5px;
      font-weight: 500;
      font-size: 0.9rem;
      color: #374151;
    }

    label.required::after {
      content: ' *';
      color: #ef4444;
    }

    input {
      width: 100%;
      padding: 10px;
      border: 2px solid #cbd5e1;
      border-radius: 8px;
      font-size: 14px;
      box-sizing: border-box;
      transition: all 0.3s;
    }

    input:focus {
      border-color: #16a34a;
      outline: none;
      box-shadow: 0 0 0 3px rgba(22, 163, 74, 0.1);
    }

    input.valid {
      border-color: #16a34a;
      background-color: #f0fdf4;
    }

    input.invalid {
      border-color: #ef4444;
      background-color: #fef2f2;
    }

    .form-note {
      font-size: 0.8em;
      color: #6b7280;
      margin-top: 3px;
      display: block;
    }

    .error-message {
      color: #ef4444;
      font-size: 0.8em;
      margin-top: 3px;
      display: none;
    }

    .error-message.show {
      display: block;
    }

    .success-message {
      color: #16a34a;
      font-size: 0.8em;
      margin-top: 3px;
      display: none;
    }

    .success-message.show {
      display: block;
    }

    .loading-message {
      color: #16a34a;
      font-size: 0.8em;
      margin-top: 3px;
      display: none;
    }

    .loading-message.show {
      display: block;
    }

    button[type="submit"] {
      width: 100%;
      padding: 12px 20px;
      background-color: #16a34a;
      color: white;
      border: none;
      border-radius: 8px;
      font-size: 16px;
      font-weight: 600;
      margin-top: 20px;
      cursor: pointer;
      transition: background 0.3s;
    }

    button[type="submit"]:hover {
      background-color: #15803d;
    }

    @media (max-width: 768px) {
      body {
        padding: 20px;
      }

      .registration-container {
        max-width: 100%;
      }

      .form-box {
        padding: 20px;
      }

      .tabs {
        flex-direction: column;
      }

      .tab-btn {
        padding: 10px;
      }
    }
  </style>
</head>
<body>
  <div class="registration-container">
    <div class="registration-header">
      <h2>üõí Criar Conta</h2>
      <p>Preencha os dados abaixo para se cadastrar no sistema</p>
    </div>

    <div class="back-link">
      <a href="{% url 'login_usuario' %}">‚Üê J√° tenho conta</a>
    </div>

    {% if messages %}
    <div class="messages">
      {% for message in messages %}
      <div class="message {% if message.tags == 'error' %}error{% else %}success{% endif %}">
        {% if message.tags == 'error' %}‚ùå{% else %}‚úì{% endif %} {{ message }}
      </div>
      {% endfor %}
    </div>
    {% endif %}

    <div class="tabs">
      <button class="tab-btn {% if tipo_selecionado != 'pj' %}active{% endif %}" id="btnFisica">
        üë§ Pessoa F√≠sica
      </button>
      <button class="tab-btn {% if tipo_selecionado == 'pj' %}active{% endif %}" id="btnJuridica">
        üè¢ Pessoa Jur√≠dica
      </button>
    </div>

    <!-- FORMUL√ÅRIO PESSOA F√çSICA -->
    <form method="post" action="{% url 'cadastro_usuario' %}" class="form-box {% if tipo_selecionado != 'pj' %}active{% endif %}" id="formFisica">
      {% csrf_token %}
      <input type="hidden" name="tipo_cliente" value="PF">

      <div class="form-section">
        <div class="form-section-title">Credenciais de Acesso</div>

        <div class="form-group">
          <label for="emailFisica" class="required">Email</label>
          <input type="email" id="emailFisica" name="email" placeholder="seu@email.com" value="{{ form_data.email }}" required>
        </div>

        <div class="form-group">
          <label for="senhaFisica" class="required">Senha</label>
          <input type="password" id="senhaFisica" name="senha" placeholder="M√≠nimo 6 caracteres" required>
          <span class="form-note">M√≠nimo 6 caracteres</span>
        </div>

        <div class="form-group">
          <label for="confirmarSenhaFisica" class="required">Confirmar Senha</label>
          <input type="password" id="confirmarSenhaFisica" name="confirmar_senha" placeholder="Confirme sua senha" required>
        </div>
      </div>

      <div class="form-section">
        <div class="form-section-title">Dados Pessoais</div>

        <div class="form-group">
          <label for="cpfFisica" class="required">CPF</label>
          <input type="text" id="cpfFisica" name="cpf" maxlength="14" placeholder="000.000.000-00" value="{{ form_data.cpf }}" required>
        </div>

        <div class="form-group">
          <label for="nomeFisica" class="required">Nome Completo</label>
          <input type="text" id="nomeFisica" name="nome" maxlength="150" placeholder="Digite seu nome completo" value="{{ form_data.nome }}" required>
        </div>

        <div class="form-group">
          <label for="dataNascimentoFisica" class="required">Data de Nascimento</label>
          <input type="date" id="dataNascimentoFisica" name="data_nascimento" value="{{ form_data.data_nascimento }}" required>
        </div>

        <div class="form-group">
          <label for="rgFisica">RG</label>
          <input type="text" id="rgFisica" name="rg" maxlength="20" placeholder="(opcional)" value="{{ form_data.rg }}">
          <span class="form-note">Campo opcional</span>
        </div>
      </div>

      <div class="form-section">
        <div class="form-section-title">Contato</div>

        <div class="form-group">
          <label for="telefonePrincipalFisica" class="required">Telefone Principal</label>
          <input type="tel" id="telefonePrincipalFisica" name="telefone_principal" maxlength="15" placeholder="(00) 00000-0000" value="{{ form_data.telefone_principal }}" required>
        </div>

        <div class="form-group">
          <label for="telefoneSecundarioFisica">Telefone Secund√°rio</label>
          <input type="tel" id="telefoneSecundarioFisica" name="telefone_secundario" maxlength="15" placeholder="(00) 00000-0000" value="{{ form_data.telefone_secundario }}">
          <span class="form-note">Campo opcional</span>
        </div>
      </div>

      <div class="form-section">
        <div class="form-section-title">Endere√ßo</div>

        <div class="form-group">
          <label for="cepFisica" class="required">CEP</label>
          <input type="text" id="cepFisica" name="cep" maxlength="9" placeholder="00000-000" value="{{ form_data.cep }}" required>
        </div>

        <div class="form-group">
          <label for="logradouroFisica" class="required">Logradouro</label>
          <input type="text" id="logradouroFisica" name="logradouro" maxlength="150" value="{{ form_data.logradouro }}" required>
        </div>

        <div class="form-group">
          <label for="numeroFisica" class="required">N√∫mero</label>
          <input type="text" id="numeroFisica" name="numero" maxlength="10" value="{{ form_data.numero }}" required>
        </div>

        <div class="form-group">
          <label for="complementoFisica">Complemento</label>
          <input type="text" id="complementoFisica" name="complemento" maxlength="50" placeholder="Apto, Sala, etc" value="{{ form_data.complemento }}">
          <span class="form-note">Campo opcional</span>
        </div>

        <div class="form-group">
          <label for="bairroFisica" class="required">Bairro</label>
          <input type="text" id="bairroFisica" name="bairro" maxlength="80" value="{{ form_data.bairro }}" required>
        </div>

        <div class="form-group">
          <label for="cidadeFisica" class="required">Cidade</label>
          <input type="text" id="cidadeFisica" name="cidade" maxlength="100" value="{{ form_data.cidade }}" required>
        </div>

        <div class="form-group">
          <label for="estadoFisica" class="required">Estado</label>
          <input type="text" id="estadoFisica" name="estado" maxlength="2" placeholder="SP" value="{{ form_data.estado }}" required>
        </div>

        <div class="form-group">
          <label for="paisFisica" class="required">Pa√≠s</label>
          <input type="text" id="paisFisica" name="pais" maxlength="50" value="{{ form_data.pais|default:'Brasil' }}" required>
        </div>
      </div>

      <button type="submit">Finalizar Cadastro</button>
    </form>

    <!-- FORMUL√ÅRIO PESSOA JUR√çDICA -->
    <form method="post" action="{% url 'cadastro_usuario' %}" class="form-box {% if tipo_selecionado == 'pj' %}active{% endif %}" id="formJuridica">
      {% csrf_token %}
      <input type="hidden" name="tipo_cliente" value="PJ">

      <div class="form-section">
        <div class="form-section-title">Credenciais de Acesso</div>

        <div class="form-group">
          <label for="emailJuridica" class="required">Email</label>
          <input type="email" id="emailJuridica" name="email" placeholder="contato@empresa.com" value="{{ form_data.email }}" required>
        </div>

        <div class="form-group">
          <label for="senhaJuridica" class="required">Senha</label>
          <input type="password" id="senhaJuridica" name="senha" placeholder="M√≠nimo 6 caracteres" required>
          <span class="form-note">M√≠nimo 6 caracteres</span>
        </div>

        <div class="form-group">
          <label for="confirmarSenhaJuridica" class="required">Confirmar Senha</label>
          <input type="password" id="confirmarSenhaJuridica" name="confirmar_senha" placeholder="Confirme sua senha" required>
        </div>
      </div>

      <div class="form-section">
        <div class="form-section-title">Dados da Empresa</div>

        <div class="form-group">
          <label for="cnpjJuridica" class="required">CNPJ</label>
          <input type="text" id="cnpjJuridica" name="cnpj" maxlength="18" placeholder="00.000.000/0000-00" value="{{ form_data.cnpj }}" required>
        </div>

        <div class="form-group">
          <label for="razaoSocialJuridica" class="required">Raz√£o Social</label>
          <input type="text" id="razaoSocialJuridica" name="razao_social" maxlength="150" value="{{ form_data.razao_social }}" required>
        </div>

        <div class="form-group">
          <label for="nomeFantasiaJuridica">Nome de Fantasia</label>
          <input type="text" id="nomeFantasiaJuridica" name="nome_fantasia" maxlength="150" value="{{ form_data.nome_fantasia }}">
          <span class="form-note">Campo opcional</span>
        </div>

        <div class="form-group">
          <label for="dataAberturaJuridica" class="required">Data de Abertura</label>
          <input type="date" id="dataAberturaJuridica" name="data_abertura" value="{{ form_data.data_abertura }}" required>
        </div>

        <div class="form-group">
          <label for="inscricaoEstadualJuridica">Inscri√ß√£o Estadual</label>
          <input type="text" id="inscricaoEstadualJuridica" name="inscricao_estadual" maxlength="20" value="{{ form_data.inscricao_estadual }}">
          <span class="form-note">Campo opcional</span>
        </div>
      </div>

      <div class="form-section">
        <div class="form-section-title">Contato</div>

        <div class="form-group">
          <label for="telefonePrincipalJuridica" class="required">Telefone Principal</label>
          <input type="tel" id="telefonePrincipalJuridica" name="telefone_principal" maxlength="15" placeholder="(00) 00000-0000" value="{{ form_data.telefone_principal }}" required>
        </div>

        <div class="form-group">
          <label for="telefoneSecundarioJuridica">Telefone Secund√°rio</label>
          <input type="tel" id="telefoneSecundarioJuridica" name="telefone_secundario" maxlength="15" placeholder="(00) 00000-0000" value="{{ form_data.telefone_secundario }}">
          <span class="form-note">Campo opcional</span>
        </div>

        <div class="form-group">
          <label for="siteJuridica">Site Institucional</label>
          <input type="url" id="siteJuridica" name="site" placeholder="https://www.empresa.com" value="{{ form_data.site }}">
          <span class="form-note">Campo opcional</span>
        </div>
      </div>

      <div class="form-section">
        <div class="form-section-title">Endere√ßo</div>

        <div class="form-group">
          <label for="cepJuridica" class="required">CEP</label>
          <input type="text" id="cepJuridica" name="cep" maxlength="9" placeholder="00000-000" value="{{ form_data.cep }}" required>
        </div>

        <div class="form-group">
          <label for="logradouroJuridica" class="required">Logradouro</label>
          <input type="text" id="logradouroJuridica" name="logradouro" maxlength="150" value="{{ form_data.logradouro }}" required>
        </div>

        <div class="form-group">
          <label for="numeroJuridica" class="required">N√∫mero</label>
          <input type="text" id="numeroJuridica" name="numero" maxlength="10" value="{{ form_data.numero }}" required>
        </div>

        <div class="form-group">
          <label for="complementoJuridica">Complemento</label>
          <input type="text" id="complementoJuridica" name="complemento" maxlength="50" placeholder="Sala, Andar, etc" value="{{ form_data.complemento }}">
          <span class="form-note">Campo opcional</span>
        </div>

        <div class="form-group">
          <label for="bairroJuridica" class="required">Bairro</label>
          <input type="text" id="bairroJuridica" name="bairro" maxlength="80" value="{{ form_data.bairro }}" required>
        </div>

        <div class="form-group">
          <label for="cidadeJuridica" class="required">Cidade</label>
          <input type="text" id="cidadeJuridica" name="cidade" maxlength="100" value="{{ form_data.cidade }}" required>
        </div>

        <div class="form-group">
          <label for="estadoJuridica" class="required">Estado</label>
          <input type="text" id="estadoJuridica" name="estado" maxlength="2" placeholder="SP" value="{{ form_data.estado }}" required>
        </div>

        <div class="form-group">
          <label for="paisJuridica" class="required">Pa√≠s</label>
          <input type="text" id="paisJuridica" name="pais" maxlength="50" value="{{ form_data.pais|default:'Brasil' }}" required>
        </div>
      </div>

      <button type="submit">Finalizar Cadastro</button>
    </form>
  </div>

  <script>
    function mascaraCPF(v) {
      v = v.replace(/\D/g, '');
      v = v.replace(/(\d{3})(\d)/, '$1.$2');
      v = v.replace(/(\d{3})(\d)/, '$1.$2');
      v = v.replace(/(\d{3})(\d{1,2})$/, '$1-$2');
      return v;
    }

    function mascaraCNPJ(v) {
      v = v.replace(/\D/g, '');
      v = v.replace(/^(\d{2})(\d)/, '$1.$2');
      v = v.replace(/^(\d{2})\.(\d{3})(\d)/, '$1.$2.$3');
      v = v.replace(/\.(\d{3})(\d)/, '.$1/$2');
      v = v.replace(/(\d{4})(\d)/, '$1-$2');
      return v;
    }

    function mascaraCEP(v) {
      v = v.replace(/\D/g, '');
      v = v.replace(/(\d{5})(\d)/, '$1-$2');
      return v;
    }

    function mascaraTelefone(v) {
      v = v.replace(/\D/g, '');
      v = v.replace(/^(\d{2})(\d)/, '($1) $2');
      v = v.replace(/(\d{5})(\d)/, '$1-$2');
      return v;
    }

    document.getElementById('cpfFisica')?.addEventListener('input', function(e) {
      e.target.value = mascaraCPF(e.target.value);
    });
    document.getElementById('cepFisica')?.addEventListener('input', function(e) {
      e.target.value = mascaraCEP(e.target.value);
    });
    document.getElementById('telefonePrincipalFisica')?.addEventListener('input', function(e) {
      e.target.value = mascaraTelefone(e.target.value);
    });
    document.getElementById('telefoneSecundarioFisica')?.addEventListener('input', function(e) {
      e.target.value = mascaraTelefone(e.target.value);
    });

    document.getElementById('cnpjJuridica')?.addEventListener('input', function(e) {
      e.target.value = mascaraCNPJ(e.target.value);
    });
    document.getElementById('cepJuridica')?.addEventListener('input', function(e) {
      e.target.value = mascaraCEP(e.target.value);
    });
    document.getElementById('telefonePrincipalJuridica')?.addEventListener('input', function(e) {
      e.target.value = mascaraTelefone(e.target.value);
    });
    document.getElementById('telefoneSecundarioJuridica')?.addEventListener('input', function(e) {
      e.target.value = mascaraTelefone(e.target.value);
    });

    async function buscarCEP(cepInput, logradouroInput, bairroInput, cidadeInput, estadoInput) {
      const cepNumeros = cepInput.value.replace(/\D/g, '');
      if (cepNumeros.length === 8) {
        try {
          const response = await fetch('https://viacep.com.br/ws/' + cepNumeros + '/json/');
          const data = await response.json();
          if (!data.erro) {
            logradouroInput.value = data.logradouro || '';
            bairroInput.value = data.bairro || '';
            cidadeInput.value = data.localidade || '';
            estadoInput.value = data.uf || '';
          }
        } catch (error) {
          console.error('Erro ao buscar CEP:', error);
        }
      }
    }

    document.getElementById('cepFisica')?.addEventListener('blur', function() {
      buscarCEP(this, document.getElementById('logradouroFisica'), document.getElementById('bairroFisica'), document.getElementById('cidadeFisica'), document.getElementById('estadoFisica'));
    });

    document.getElementById('cepJuridica')?.addEventListener('blur', function() {
      buscarCEP(this, document.getElementById('logradouroJuridica'), document.getElementById('bairroJuridica'), document.getElementById('cidadeJuridica'), document.getElementById('estadoJuridica'));
    });

    document.getElementById('btnFisica')?.addEventListener('click', () => {
      document.getElementById('btnFisica').classList.add('active');
      document.getElementById('btnJuridica').classList.remove('active');
      document.getElementById('formFisica').classList.add('active');
      document.getElementById('formJuridica').classList.remove('active');
    });

    document.getElementById('btnJuridica')?.addEventListener('click', () => {
      document.getElementById('btnJuridica').classList.add('active');
      document.getElementById('btnFisica').classList.remove('active');
      document.getElementById('formJuridica').classList.add('active');
      document.getElementById('formFisica').classList.remove('active');
    });
  </script>
</body>
</html>
